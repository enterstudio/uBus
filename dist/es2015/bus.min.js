// Î¼Bus
export class Bus {
    constructor() {
        this._q = [];
    }
    emit(token, info) {
        for (let i = 0, len = this._q.length; i < len; i++) {
            if (this._q[i].token === token) {
                this._q[i].cb(info);
                if (this._q[i].once) {
                    this._q.splice(i, 1);
                    break;
                }
            }
        }
    }
    on(token, cb) {
        let _id = this._genId();
        this._q.push({
            _id: _id,
            token: token,
            cb: cb,
            once: false,
        });
        return () => {
            for (let i = 0, len = this._q.length; i < len; i++) {
                if (this._q[i]._id === _id) {
                    this._q.splice(i, 1);
                    break;
                }
            }
        };
    }
    once(token, cb) {
        this._q.push({
            _id: this._genId(),
            token: token,
            cb: cb,
            once: true
        });
    }
    off(token) {
        if (typeof (token) === "string") {
            for (let i = 0, len = this._q.length; i < len; i++) {
                if (this._q[i].token === token) {
                    this._q[i].del = true;
                }
            }
        }
        if ((typeof (token) === "object") && !!token.length) {
            token.forEach((t) => {
                for (let i = 0, len = this._q.length; i < len; i++) {
                    if (this._q[i].token === t) {
                        this._q[i].del = true;
                    }
                }
            });
        }
        this._q = this._q.filter((item) => !item.del);
    }
    _s4() {
        return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
    }
    _genId() {
        return this._s4() + this._s4() + '-' +
            this._s4() + '-' +
            this._s4() + '-' +
            this._s4() + '-' +
            this._s4() + this._s4() + this._s4();
    }
}
